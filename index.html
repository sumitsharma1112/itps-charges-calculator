
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ITPS Tariff Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  :root {
    --ink: #1a1a2e;
    --ink-light: #3d3d5c;
    --paper: #f5f0e8;
    --paper-dark: #e8e0cc;
    --stamp-red: #c0392b;
    --stamp-blue: #1a4a7a;
    --gold: #b8860b;
    --gold-light: #d4a017;
    --green: #1a6b3c;
    --rule: rgba(26,26,46,0.15);
  }

- { margin: 0; padding: 0; box-sizing: border-box; }

body {
font-family: ‚ÄòDM Sans‚Äô, sans-serif;
background: #d6cfc0;
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
background-image:
repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(0,0,0,0.04) 39px, rgba(0,0,0,0.04) 40px),
repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(0,0,0,0.04) 39px, rgba(0,0,0,0.04) 40px);
}

.envelope-wrapper {
width: 100%;
max-width: 680px;
position: relative;
}

/* Top decorative strip */
.top-strip {
height: 12px;
background: repeating-linear-gradient(90deg,
var(‚Äìstamp-red) 0, var(‚Äìstamp-red) 16px,
var(‚Äìpaper) 16px, var(‚Äìpaper) 20px,
var(‚Äìstamp-blue) 20px, var(‚Äìstamp-blue) 36px,
var(‚Äìpaper) 36px, var(‚Äìpaper) 40px
);
border-radius: 8px 8px 0 0;
}

.card {
background: var(‚Äìpaper);
border: 1px solid var(‚Äìpaper-dark);
border-top: none;
border-radius: 0 0 8px 8px;
padding: 40px 44px 36px;
box-shadow: 0 8px 40px rgba(0,0,0,0.18), 0 2px 8px rgba(0,0,0,0.1);
position: relative;
overflow: hidden;
}

/* Watermark */
.card::before {
content: ‚ÄúINDIA POST‚Äù;
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%) rotate(-30deg);
font-family: ‚ÄòPlayfair Display‚Äô, serif;
font-size: 72px;
font-weight: 700;
color: rgba(26,26,46,0.035);
letter-spacing: 8px;
white-space: nowrap;
pointer-events: none;
z-index: 0;
}

.card > * { position: relative; z-index: 1; }

/* Header */
.header {
display: flex;
align-items: flex-start;
justify-content: space-between;
margin-bottom: 28px;
padding-bottom: 24px;
border-bottom: 2px solid var(‚Äìink);
position: relative;
}

.header::after {
content: ‚Äò‚Äô;
position: absolute;
bottom: -5px;
left: 0; right: 0;
height: 1px;
background: var(‚Äìrule);
}

.header-left {}

.header-badge {
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 9px;
letter-spacing: 3px;
text-transform: uppercase;
color: var(‚Äìstamp-red);
background: rgba(192,57,43,0.1);
border: 1px solid rgba(192,57,43,0.3);
padding: 3px 8px;
display: inline-block;
margin-bottom: 10px;
}

.header h1 {
font-family: ‚ÄòPlayfair Display‚Äô, serif;
font-size: 28px;
font-weight: 700;
color: var(‚Äìink);
line-height: 1.1;
letter-spacing: -0.5px;
}

.header h1 span {
color: var(‚Äìstamp-red);
}

.header-sub {
font-size: 12px;
color: var(‚Äìink-light);
margin-top: 6px;
font-weight: 300;
letter-spacing: 0.5px;
}

.stamp-area {
text-align: center;
border: 2.5px solid var(‚Äìstamp-red);
padding: 8px 12px;
min-width: 80px;
position: relative;
}

.stamp-area::before, .stamp-area::after {
content: ‚Äò‚Äô;
position: absolute;
top: -2.5px; bottom: -2.5px;
width: 8px;
background: radial-gradient(circle at 50% 50%, var(‚Äìpaper-dark) 3px, transparent 3px) repeat-y;
background-size: 8px 8px;
}
.stamp-area::before { left: -6px; }
.stamp-area::after { right: -6px; }

.stamp-icon { font-size: 22px; line-height: 1; }
.stamp-text {
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 8px;
color: var(‚Äìstamp-red);
letter-spacing: 1.5px;
text-transform: uppercase;
margin-top: 4px;
display: block;
}

/* Form */
.form-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
margin-bottom: 24px;
}

.field { display: flex; flex-direction: column; gap: 7px; }
.field.full { grid-column: 1 / -1; }

label {
font-size: 10px;
font-weight: 500;
letter-spacing: 2px;
text-transform: uppercase;
color: var(‚Äìink-light);
font-family: ‚ÄòDM Mono‚Äô, monospace;
}

select, input[type=‚Äúnumber‚Äù] {
background: white;
border: 1.5px solid var(‚Äìpaper-dark);
border-bottom: 2px solid var(‚Äìink);
padding: 10px 14px;
font-family: ‚ÄòDM Sans‚Äô, sans-serif;
font-size: 14px;
color: var(‚Äìink);
outline: none;
transition: border-color 0.2s, box-shadow 0.2s;
appearance: none;
-webkit-appearance: none;
border-radius: 0;
width: 100%;
}

.select-wrapper {
position: relative;
}

.select-wrapper::after {
content: ‚Äò‚ñæ‚Äô;
position: absolute;
right: 12px;
top: 50%;
transform: translateY(-50%);
color: var(‚Äìink-light);
pointer-events: none;
font-size: 12px;
}

select:focus, input[type=‚Äúnumber‚Äù]:focus {
border-color: var(‚Äìstamp-blue);
box-shadow: 0 2px 0 var(‚Äìstamp-blue);
background: #fff;
}

/* Weight info badge */
.weight-info {
display: none;
align-items: center;
gap: 8px;
background: rgba(26,74,122,0.08);
border: 1px solid rgba(26,74,122,0.25);
border-left: 3px solid var(‚Äìstamp-blue);
padding: 9px 13px;
margin-top: -4px;
}

.weight-info.visible { display: flex; }

.weight-info-icon { font-size: 14px; }
.weight-info-text {
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 11px;
color: var(‚Äìstamp-blue);
letter-spacing: 0.5px;
}
.weight-info-text strong { font-weight: 600; }

/* Warning */
.weight-warning {
display: none;
align-items: center;
gap: 8px;
background: rgba(192,57,43,0.07);
border: 1px solid rgba(192,57,43,0.3);
border-left: 3px solid var(‚Äìstamp-red);
padding: 9px 13px;
margin-top: 8px;
}
.weight-warning.visible { display: flex; }
.weight-warning-text {
font-size: 11px;
color: var(‚Äìstamp-red);
font-family: ‚ÄòDM Mono‚Äô, monospace;
letter-spacing: 0.5px;
}

/* PDF Button */
.btn-row {
display: grid;
grid-template-columns: 1fr auto;
gap: 10px;
margin-top: 4px;
}

.btn-calculate {
background: var(‚Äìink);
color: var(‚Äìpaper);
border: none;
padding: 14px 24px;
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 13px;
letter-spacing: 3px;
text-transform: uppercase;
cursor: pointer;
transition: background 0.2s, transform 0.1s;
position: relative;
overflow: hidden;
width: 100%;
}

.btn-calculate::after {
content: ‚Äò‚Üí‚Äô;
position: absolute;
right: 20px;
top: 50%;
transform: translateY(-50%);
transition: right 0.2s;
font-size: 16px;
}

.btn-calculate:hover { background: var(‚Äìstamp-blue); }
.btn-calculate:hover::after { right: 16px; }
.btn-calculate:active { transform: scale(0.995); }

.btn-pdf {
background: var(‚Äìstamp-red);
color: white;
border: none;
padding: 14px 18px;
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 11px;
letter-spacing: 1.5px;
text-transform: uppercase;
cursor: pointer;
transition: background 0.2s, transform 0.1s, opacity 0.2s;
display: flex;
align-items: center;
gap: 7px;
white-space: nowrap;
opacity: 0;
pointer-events: none;
}

.btn-pdf.active {
opacity: 1;
pointer-events: all;
}

.btn-pdf:hover { background: #a93226; }
.btn-pdf:active { transform: scale(0.98); }

.btn-pdf svg {
width: 14px; height: 14px;
fill: white;
flex-shrink: 0;
}

/* PDF loading overlay */
.pdf-loading {
display: none;
position: fixed;
inset: 0;
background: rgba(26,26,46,0.6);
z-index: 9999;
align-items: center;
justify-content: center;
backdrop-filter: blur(3px);
}

.pdf-loading.active { display: flex; }

.pdf-loading-box {
background: var(‚Äìpaper);
padding: 32px 40px;
text-align: center;
border-top: 4px solid var(‚Äìstamp-red);
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.pdf-loading-icon {
font-size: 32px;
display: block;
margin-bottom: 14px;
animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
0%, 100% { transform: scale(1); opacity: 1; }
50% { transform: scale(1.1); opacity: 0.7; }
}

.pdf-loading-text {
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 11px;
letter-spacing: 2px;
text-transform: uppercase;
color: var(‚Äìink-light);
}

/* Hidden PDF receipt template */
.pdf-receipt-template {
position: fixed;
left: -9999px;
top: 0;
width: 560px;
background: #f5f0e8;
font-family: Arial, Helvetica, sans-serif;
padding: 0;
z-index: -1;
}

/* Results */
.results {
margin-top: 28px;
border-top: 2px solid var(‚Äìink);
padding-top: 24px;
display: none;
animation: slideIn 0.3s ease;
}

.results.visible { display: block; }

@keyframes slideIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}

.results-header {
display: flex;
align-items: center;
justify-content: space-between;
margin-bottom: 18px;
}

.results-title {
font-family: ‚ÄòPlayfair Display‚Äô, serif;
font-size: 15px;
font-weight: 600;
color: var(‚Äìink);
letter-spacing: 0.5px;
}

.results-tag {
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 9px;
letter-spacing: 2px;
color: var(‚Äìgreen);
background: rgba(26,107,60,0.1);
border: 1px solid rgba(26,107,60,0.3);
padding: 3px 8px;
text-transform: uppercase;
}

.receipt {
background: white;
border: 1px solid var(‚Äìpaper-dark);
padding: 0;
overflow: hidden;
}

.receipt-row {
display: flex;
justify-content: space-between;
align-items: center;
padding: 11px 16px;
border-bottom: 1px dashed var(‚Äìrule);
}

.receipt-row:last-child { border-bottom: none; }

.receipt-row.total {
background: var(‚Äìink);
border-bottom: none;
padding: 14px 16px;
}

.receipt-row.gst {
background: rgba(26,107,60,0.05);
}

.receipt-label {
font-size: 12px;
color: var(‚Äìink-light);
font-weight: 400;
}

.receipt-row.total .receipt-label {
color: var(‚Äìpaper);
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 11px;
letter-spacing: 2px;
text-transform: uppercase;
}

.receipt-value {
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 14px;
color: var(‚Äìink);
font-weight: 500;
}

.receipt-row.gst .receipt-value { color: var(‚Äìgreen); }

.receipt-row.total .receipt-value {
color: var(‚Äìgold-light);
font-size: 20px;
font-weight: 500;
}

.receipt-sublabel {
font-size: 10px;
color: rgba(26,26,46,0.45);
margin-top: 2px;
}

/* Breakdown detail */
.breakdown {
margin-top: 12px;
background: rgba(26,26,46,0.03);
border: 1px solid var(‚Äìrule);
padding: 12px 16px;
}

.breakdown-title {
font-family: ‚ÄòDM Mono‚Äô, monospace;
font-size: 9px;
letter-spacing: 2px;
text-transform: uppercase;
color: var(‚Äìink-light);
margin-bottom: 8px;
}

.breakdown-line {
font-size: 12px;
color: var(‚Äìink-light);
display: flex;
justify-content: space-between;
padding: 3px 0;
font-family: ‚ÄòDM Mono‚Äô, monospace;
}

.breakdown-line span:last-child { color: var(‚Äìink); font-weight: 500; }

/* Footer */
.card-footer {
margin-top: 28px;
padding-top: 18px;
border-top: 1px solid var(‚Äìrule);
display: flex;
justify-content: space-between;
align-items: center;
}

.footer-note {
font-size: 10px;
color: rgba(26,26,46,0.4);
font-family: ‚ÄòDM Mono‚Äô, monospace;
letter-spacing: 0.5px;
}

.footer-logo {
font-family: ‚ÄòPlayfair Display‚Äô, serif;
font-size: 12px;
color: rgba(26,26,46,0.35);
letter-spacing: 1px;
}

@media (max-width: 500px) {
.card { padding: 28px 22px 24px; }
.form-grid { grid-template-columns: 1fr; }
.header h1 { font-size: 22px; }
.stamp-area { display: none; }
}
</style>

</head>
<body>

<div class="envelope-wrapper">
  <div class="top-strip"></div>
  <div class="card">

<div class="header">
  <div class="header-left">
    <div class="header-badge">India Post ¬∑ International</div>
    <h1>ITPS <span>Tariff</span><br>Calculator</h1>
    <p class="header-sub">International Tracked Packet Service</p>
  </div>
  <div class="stamp-area">
    <div class="stamp-icon">‚úâ</div>
    <span class="stamp-text">India Post</span>
  </div>
</div>

<div class="form-grid">

  <div class="field full">
    <label>Destination Country</label>
    <div class="select-wrapper">
      <select id="country" onchange="onCountryChange()">
        <option value="">‚Äî Select a country ‚Äî</option>
      </select>
    </div>
    <div class="weight-info" id="weightInfo">
      <span class="weight-info-icon">üì¶</span>
      <span class="weight-info-text">Max permissible weight: <strong id="maxWeightDisplay">‚Äî</strong></span>
    </div>
  </div>

  <div class="field full">
    <label>Packet Weight (grams)</label>
    <input type="number" id="weight" min="1" max="2000" step="1" placeholder="Enter weight in grams" oninput="onWeightInput()">
    <div class="weight-warning" id="weightWarning">
      <span>‚ö†</span>
      <span class="weight-warning-text" id="weightWarningText">Weight exceeds maximum limit</span>
    </div>
  </div>

</div>

<div class="btn-row">
  <button class="btn-calculate" onclick="calculate()">Calculate Postage</button>
  <button class="btn-pdf" id="btnPdf" onclick="exportPDF()">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 1.5L18.5 9H13V3.5zM6 20V4h5v7h7v9H6zm2-5h8v1.5H8V15zm0 3h5v1.5H8V18zm0-6h2v1.5H8V12z"/>
    </svg>
    Save PDF
  </button>
</div>

<div class="results" id="results">
  <div class="results-header">
    <span class="results-title">Postage Breakdown</span>
    <span class="results-tag">‚úì Calculated</span>
  </div>

  <div class="receipt">
    <div class="receipt-row">
      <div>
        <div class="receipt-label">Base Tariff (First 50g)</div>
        <div class="receipt-sublabel" id="baseTariffNote"></div>
      </div>
      <div class="receipt-value" id="baseTariffVal">‚Äî</div>
    </div>
    <div class="receipt-row" id="additionalRow">
      <div>
        <div class="receipt-label">Additional Weight Charge</div>
        <div class="receipt-sublabel" id="additionalNote"></div>
      </div>
      <div class="receipt-value" id="additionalVal">‚Äî</div>
    </div>
    <div class="receipt-row">
      <div>
        <div class="receipt-label">Subtotal (before GST)</div>
      </div>
      <div class="receipt-value" id="subtotalVal">‚Äî</div>
    </div>
    <div class="receipt-row gst">
      <div>
        <div class="receipt-label">GST @ 18%</div>
      </div>
      <div class="receipt-value" id="gstVal">‚Äî</div>
    </div>
    <div class="receipt-row total">
      <div class="receipt-label">Total Payable</div>
      <div class="receipt-value" id="totalVal">‚Äî</div>
    </div>
  </div>

  <div class="breakdown" id="breakdown">
    <div class="breakdown-title">Calculation Detail</div>
    <div class="breakdown-line" id="bLine1"></div>
    <div class="breakdown-line" id="bLine2"></div>
    <div class="breakdown-line" id="bLine3"></div>
  </div>
</div>

<div class="card-footer">
  <span class="footer-note">Tariffs in INR ¬∑ Subject to revision</span>
  <span class="footer-logo">India Post</span>
</div>


  </div>
</div>

<!-- PDF Loading Overlay -->

<div class="pdf-loading" id="pdfLoading">
  <div class="pdf-loading-box">
    <span class="pdf-loading-icon">üìÑ</span>
    <div class="pdf-loading-text">Generating PDF‚Ä¶</div>
  </div>
</div>

<!-- Hidden PDF Receipt Template (rendered off-screen for capture) -->

<div class="pdf-receipt-template" id="pdfTemplate"></div>

<script>
const tariffData = [
  { country: "Afghanistan", first50: 285, additional: 50, maxWeight: "2 kg" },
  { country: "Albania", first50: 275, additional: 40, maxWeight: "2 kg" },
  { country: "Algeria", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Angola", first50: 315, additional: 60, maxWeight: "2 kg" },
  { country: "Argentina", first50: 360, additional: 65, maxWeight: "2 kg" },
  { country: "Armenia", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Aruba", first50: 220, additional: 50, maxWeight: "5 kg" },
  { country: "Australia", first50: 395, additional: 45, maxWeight: "2 kg" },
  { country: "Austria", first50: 325, additional: 30, maxWeight: "2 kg" },
  { country: "Azerbaijan", first50: 255, additional: 25, maxWeight: "2 kg" },
  { country: "Bahrain", first50: 290, additional: 20, maxWeight: "2 kg" },
  { country: "Bangladesh", first50: 240, additional: 20, maxWeight: "2 kg" },
  { country: "Belarus", first50: 195, additional: 25, maxWeight: "5 kg" },
  { country: "Belgium", first50: 325, additional: 30, maxWeight: "2 kg" },
  { country: "Benin", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Bhutan", first50: 185, additional: 15, maxWeight: "5 kg" },
  { country: "Bosnia and Herzegovina", first50: 355, additional: 35, maxWeight: "2 kg" },
  { country: "Botswana", first50: 295, additional: 55, maxWeight: "2 kg" },
  { country: "Brazil", first50: 290, additional: 55, maxWeight: "2 kg" },
  { country: "Brunei Darussalam", first50: 260, additional: 30, maxWeight: "2 kg" },
  { country: "Bulgaria", first50: 195, additional: 25, maxWeight: "5 kg" },
  { country: "Burkina Faso", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Burundi", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Cambodia", first50: 310, additional: 25, maxWeight: "2 kg" },
  { country: "Cameroon", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Canada", first50: 360, additional: 40, maxWeight: "2 kg" },
  { country: "Chile", first50: 235, additional: 65, maxWeight: "5 kg" },
  { country: "China", first50: 185, additional: 15, maxWeight: "5 kg" },
  { country: "Colombia", first50: 315, additional: 60, maxWeight: "2 kg" },
  { country: "Costa Rica", first50: 300, additional: 55, maxWeight: "2 kg" },
  { country: "Cote d'Ivoire", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Croatia", first50: 355, additional: 30, maxWeight: "2 kg" },
  { country: "Curacao", first50: 220, additional: 50, maxWeight: "5 kg" },
  { country: "Cyprus", first50: 305, additional: 35, maxWeight: "2 kg" },
  { country: "Czechia", first50: 275, additional: 30, maxWeight: "2 kg" },
  { country: "Denmark", first50: 325, additional: 30, maxWeight: "2 kg" },
  { country: "Djibouti", first50: 290, additional: 45, maxWeight: "2 kg" },
  { country: "Dominican Republic", first50: 235, additional: 65, maxWeight: "5 kg" },
  { country: "Egypt", first50: 195, additional: 25, maxWeight: "5 kg" },
  { country: "Eritrea", first50: 280, additional: 50, maxWeight: "2 kg" },
  { country: "Estonia", first50: 220, additional: 25, maxWeight: "5 kg" },
  { country: "Eswatini", first50: 290, additional: 55, maxWeight: "2 kg" },
  { country: "Ethiopia", first50: 280, additional: 50, maxWeight: "2 kg" },
  { country: "Finland", first50: 370, additional: 35, maxWeight: "2 kg" },
  { country: "France", first50: 335, additional: 30, maxWeight: "2 kg" },
  { country: "Gabon", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Gambia", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Georgia", first50: 205, additional: 35, maxWeight: "2 kg" },
  { country: "Germany", first50: 245, additional: 25, maxWeight: "2 kg" },
  { country: "Ghana", first50: 385, additional: 50, maxWeight: "2 kg" },
  { country: "Gibraltar", first50: 200, additional: 30, maxWeight: "5 kg" },
  { country: "Great Britain", first50: 200, additional: 25, maxWeight: "5 kg" },
  { country: "Greece", first50: 375, additional: 35, maxWeight: "2 kg" },
  { country: "Hong Kong", first50: 190, additional: 15, maxWeight: "5 kg" },
  { country: "Hungary", first50: 315, additional: 30, maxWeight: "2 kg" },
  { country: "Iceland", first50: 350, additional: 50, maxWeight: "2 kg" },
  { country: "Indonesia", first50: 305, additional: 20, maxWeight: "2 kg" },
  { country: "Iran (Islamic Republic)", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Iraq", first50: 285, additional: 45, maxWeight: "2 kg" },
  { country: "Ireland", first50: 320, additional: 35, maxWeight: "2 kg" },
  { country: "Israel", first50: 360, additional: 35, maxWeight: "2 kg" },
  { country: "Italy", first50: 350, additional: 30, maxWeight: "2 kg" },
  { country: "Japan", first50: 310, additional: 20, maxWeight: "2 kg" },
  { country: "Jersey", first50: 210, additional: 25, maxWeight: "5 kg" },
  { country: "Jordan", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Kazakhstan", first50: 190, additional: 10, maxWeight: "5 kg" },
  { country: "Kenya", first50: 240, additional: 30, maxWeight: "2 kg" },
  { country: "Kiribati", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Korea (Republic)", first50: 310, additional: 20, maxWeight: "2 kg" },
  { country: "Kuwait", first50: 230, additional: 25, maxWeight: "2 kg" },
  { country: "Kyrgyzstan", first50: 280, additional: 50, maxWeight: "2 kg" },
  { country: "Latvia", first50: 385, additional: 35, maxWeight: "2 kg" },
  { country: "Liberia", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Lithuania", first50: 195, additional: 25, maxWeight: "5 kg" },
  { country: "Luxembourg", first50: 320, additional: 30, maxWeight: "2 kg" },
  { country: "Macao (China)", first50: 265, additional: 30, maxWeight: "2 kg" },
  { country: "Malawi", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Malaysia", first50: 190, additional: 15, maxWeight: "5 kg" },
  { country: "Maldives", first50: 195, additional: 15, maxWeight: "2 kg" },
  { country: "Mali", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Malta", first50: 340, additional: 35, maxWeight: "2 kg" },
  { country: "Mauritius", first50: 295, additional: 35, maxWeight: "2 kg" },
  { country: "Mexico", first50: 220, additional: 50, maxWeight: "5 kg" },
  { country: "Moldova", first50: 290, additional: 60, maxWeight: "2 kg" },
  { country: "Mongolia", first50: 345, additional: 60, maxWeight: "2 kg" },
  { country: "Montenegro", first50: 270, additional: 35, maxWeight: "2 kg" },
  { country: "Morocco", first50: 195, additional: 25, maxWeight: "5 kg" },
  { country: "Mozambique", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Myanmar", first50: 185, additional: 15, maxWeight: "5 kg" },
  { country: "Namibia", first50: 280, additional: 45, maxWeight: "2 kg" },
  { country: "Nepal", first50: 220, additional: 15, maxWeight: "2 kg" },
  { country: "Netherlands", first50: 320, additional: 30, maxWeight: "2 kg" },
  { country: "New Zealand", first50: 390, additional: 55, maxWeight: "2 kg" },
  { country: "Nigeria", first50: 250, additional: 45, maxWeight: "2 kg" },
  { country: "North Macedonia", first50: 295, additional: 40, maxWeight: "2 kg" },
  { country: "Norway", first50: 325, additional: 35, maxWeight: "2 kg" },
  { country: "Oman", first50: 200, additional: 15, maxWeight: "5 kg" },
  { country: "Papua New Guinea", first50: 300, additional: 65, maxWeight: "2 kg" },
  { country: "Philippines", first50: 205, additional: 15, maxWeight: "5 kg" },
  { country: "Poland", first50: 355, additional: 30, maxWeight: "2 kg" },
  { country: "Portugal", first50: 305, additional: 35, maxWeight: "2 kg" },
  { country: "Qatar", first50: 385, additional: 25, maxWeight: "2 kg" },
  { country: "Romania", first50: 310, additional: 25, maxWeight: "2 kg" },
  { country: "Russian Federation", first50: 245, additional: 30, maxWeight: "5 kg" },
  { country: "Rwanda", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Saudi Arabia", first50: 280, additional: 25, maxWeight: "2 kg" },
  { country: "Senegal", first50: 275, additional: 45, maxWeight: "2 kg" },
  { country: "Serbia", first50: 325, additional: 30, maxWeight: "2 kg" },
  { country: "Sierra Leone", first50: 295, additional: 45, maxWeight: "2 kg" },
  { country: "Singapore", first50: 185, additional: 15, maxWeight: "5 kg" },
  { country: "Slovakia", first50: 300, additional: 30, maxWeight: "2 kg" },
  { country: "Slovenia", first50: 260, additional: 30, maxWeight: "2 kg" },
  { country: "Solomon Island", first50: 220, additional: 45, maxWeight: "5 kg" },
  { country: "South Africa", first50: 245, additional: 35, maxWeight: "2 kg" },
  { country: "Spain", first50: 295, additional: 35, maxWeight: "2 kg" },
  { country: "Sri Lanka", first50: 305, additional: 15, maxWeight: "2 kg" },
  { country: "Sweden", first50: 320, additional: 30, maxWeight: "2 kg" },
  { country: "Switzerland", first50: 350, additional: 35, maxWeight: "2 kg" },
  { country: "Tajikistan", first50: 280, additional: 50, maxWeight: "2 kg" },
  { country: "Tanzania (United Republic)", first50: 300, additional: 55, maxWeight: "2 kg" },
  { country: "Thailand", first50: 185, additional: 10, maxWeight: "5 kg" },
  { country: "Togo", first50: 280, additional: 45, maxWeight: "2 kg" },
  { country: "Tunisia", first50: 280, additional: 50, maxWeight: "2 kg" },
  { country: "T√ºrkiye", first50: 370, additional: 35, maxWeight: "2 kg" },
  { country: "Turkmenistan", first50: 300, additional: 50, maxWeight: "2 kg" },
  { country: "Tuvalu", first50: 235, additional: 65, maxWeight: "5 kg" },
  { country: "Uganda", first50: 280, additional: 50, maxWeight: "2 kg" },
  { country: "Ukraine", first50: 195, additional: 20, maxWeight: "2 kg" },
  { country: "United Arab Emirates", first50: 185, additional: 15, maxWeight: "5 kg" },
  { country: "United States of America", first50: 400, additional: 35, maxWeight: "5 kg" },
  { country: "Uruguay", first50: 230, additional: 60, maxWeight: "5 kg" },
  { country: "Uzbekistan", first50: 280, additional: 50, maxWeight: "2 kg" },
  { country: "Vietnam", first50: 190, additional: 20, maxWeight: "5 kg" },
  { country: "Zambia", first50: 285, additional: 55, maxWeight: "2 kg" },
  { country: "Zimbabwe", first50: 225, additional: 55, maxWeight: "5 kg" },
];

// Populate dropdown
const select = document.getElementById('country');
tariffData.forEach(d => {
  const opt = document.createElement('option');
  opt.value = d.country;
  opt.textContent = d.country;
  select.appendChild(opt);
});

function getMaxWeightGrams(maxWeight) {
  if (maxWeight.includes('5')) return 5000;
  return 2000;
}

function onCountryChange() {
  const val = select.value;
  const weightInfo = document.getElementById('weightInfo');
  const maxDisplay = document.getElementById('maxWeightDisplay');

  if (val) {
    const data = tariffData.find(d => d.country === val);
    maxDisplay.textContent = data.maxWeight;
    weightInfo.classList.add('visible');
    // Re-check weight warning if weight is already entered
    onWeightInput();
  } else {
    weightInfo.classList.remove('visible');
    document.getElementById('weightWarning').classList.remove('visible');
  }

  // Hide results on country change
  document.getElementById('results').classList.remove('visible');
}

function onWeightInput() {
  const val = select.value;
  const weightVal = parseInt(document.getElementById('weight').value);
  const warning = document.getElementById('weightWarning');
  const warningText = document.getElementById('weightWarningText');

  if (!val || !weightVal) {
    warning.classList.remove('visible');
    return;
  }

  const data = tariffData.find(d => d.country === val);
  const maxGrams = getMaxWeightGrams(data.maxWeight);

  if (weightVal > maxGrams) {
    warningText.textContent = ‚ö† Exceeds maximum limit of ${data.maxWeight} for ${val};
    warning.classList.add('visible');
  } else {
    warning.classList.remove('visible');
  }
}

function fmt(n) {
  return 'Rs.' + n.toFixed(2);
}

// Store last calculated values for PDF
let lastCalc = null;

function calculate() {
  const countryVal = select.value;
  const weightVal = parseInt(document.getElementById('weight').value);

  if (!countryVal) {
    select.focus();
    select.style.borderColor = 'var(--stamp-red)';
    setTimeout(() => select.style.borderColor = '', 1500);
    return;
  }

  if (!weightVal || weightVal < 1) {
    const wi = document.getElementById('weight');
    wi.focus();
    wi.style.borderColor = 'var(--stamp-red)';
    setTimeout(() => wi.style.borderColor = '', 1500);
    return;
  }

  const data = tariffData.find(d => d.country === countryVal);
  const maxGrams = getMaxWeightGrams(data.maxWeight);

  if (weightVal > maxGrams) return;

  const baseTariff = data.first50;
  let additionalChunks = 0;
  let additionalCharge = 0;
  if (weightVal > 50) {
    additionalChunks = Math.ceil((weightVal - 50) / 50);
    additionalCharge = additionalChunks * data.additional;
  }

  const subtotal = baseTariff + additionalCharge;
  const gst = subtotal * 0.18;
  const total = subtotal + gst;

  // Save for PDF
  lastCalc = { countryVal, weightVal, baseTariff, additionalChunks, additionalCharge, data, subtotal, gst, total };

  document.getElementById('baseTariffVal').textContent = fmt(baseTariff);
  document.getElementById('baseTariffNote').textContent = Rs.${data.first50} for first 50g;

  const addRow = document.getElementById('additionalRow');
  if (additionalChunks > 0) {
    document.getElementById('additionalVal').textContent = fmt(additionalCharge);
    document.getElementById('additionalNote').textContent =
      ${additionalChunks} x Rs.${data.additional} (${weightVal - 50}g extra - ${additionalChunks} slab${additionalChunks > 1 ? 's' : ''});
    addRow.style.display = 'flex';
  } else {
    addRow.style.display = 'none';
  }

  document.getElementById('subtotalVal').textContent = fmt(subtotal);
  document.getElementById('gstVal').textContent = fmt(gst);
  document.getElementById('totalVal').textContent = fmt(total);

  document.getElementById('bLine1').innerHTML = <span>Base (first 50g)</span><span>Rs.${baseTariff}.00</span>;
  if (additionalChunks > 0) {
    document.getElementById('bLine2').innerHTML = <span>+ ${additionalChunks} add. slab(s) x Rs.${data.additional}</span><span>Rs.${additionalCharge}.00</span>;
    document.getElementById('bLine3').innerHTML = <span>+ GST 18% on Rs.${subtotal}</span><span>Rs.${gst.toFixed(2)}</span>;
  } else {
    document.getElementById('bLine2').innerHTML = <span>+ GST 18% on Rs.${subtotal}</span><span>Rs.${gst.toFixed(2)}</span>;
    document.getElementById('bLine3').innerHTML = <span></span><span></span>;
  }

  const results = document.getElementById('results');
  results.classList.remove('visible');
  void results.offsetWidth;
  results.classList.add('visible');

  document.getElementById('btnPdf').classList.add('active');
}

function buildPdfTemplate(c) {
  const now = new Date();
  const dateStr = now.toLocaleDateString('en-IN', { day:'2-digit', month:'short', year:'numeric' });
  const timeStr = now.toLocaleTimeString('en-IN', { hour:'2-digit', minute:'2-digit' });

  const addRowHtml = c.additionalChunks > 0 ? 
    <tr>
      <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-size:12px; color:#3d3d5c;">
        Additional Weight Charge
        <div style="font-size:10px; color:#888; margin-top:2px;">${c.additionalChunks} x Rs.${c.data.additional} (${c.weightVal - 50}g extra &rarr; ${c.additionalChunks} slab${c.additionalChunks > 1 ? 's' : ''})</div>
      </td>
      <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-family:monospace; font-size:14px; color:#1a1a2e; font-weight:600; text-align:right;">Rs.${c.additionalCharge}.00</td>
    </tr> : '';

  const bLine2 = c.additionalChunks > 0
    ? <tr><td style="padding:3px 0; font-size:11px; color:#555; font-family:monospace;">+ ${c.additionalChunks} add. slab(s) &times; Rs.${c.data.additional}</td><td style="padding:3px 0; font-size:11px; color:#1a1a2e; font-family:monospace; text-align:right; font-weight:600;">Rs.${c.additionalCharge}.00</td></tr>
    : <tr><td style="padding:3px 0; font-size:11px; color:#555; font-family:monospace;">+ GST 18% on Rs.${c.subtotal}</td><td style="padding:3px 0; font-size:11px; color:#1a6b3c; font-family:monospace; text-align:right; font-weight:600;">Rs.${c.gst.toFixed(2)}</td></tr>;

  const bLine3 = c.additionalChunks > 0
    ? <tr><td style="padding:3px 0; font-size:11px; color:#555; font-family:monospace;">+ GST 18% on Rs.${c.subtotal}</td><td style="padding:3px 0; font-size:11px; color:#1a6b3c; font-family:monospace; text-align:right; font-weight:600;">Rs.${c.gst.toFixed(2)}</td></tr>
    : '';

  return 
  <div style="background:#f5f0e8; width:560px; font-family:Arial,Helvetica,sans-serif; padding:0; overflow:hidden;">
    <!-- Top strip -->
    <div style="height:10px; background:repeating-linear-gradient(90deg,#c0392b 0,#c0392b 16px,#f5f0e8 16px,#f5f0e8 20px,#1a4a7a 20px,#1a4a7a 36px,#f5f0e8 36px,#f5f0e8 40px);"></div>

    <div style="padding:32px 40px 28px;">
      <!-- Header -->
      <div style="display:flex; justify-content:space-between; align-items:flex-start; border-bottom:2px solid #1a1a2e; padding-bottom:20px; margin-bottom:24px;">
        <div>
          <div style="font-size:8px; letter-spacing:3px; text-transform:uppercase; color:#c0392b; background:rgba(192,57,43,0.1); border:1px solid rgba(192,57,43,0.3); padding:3px 8px; display:inline-block; margin-bottom:8px; font-family:monospace;">India Post &middot; International</div>
          <div style="font-size:24px; font-weight:700; color:#1a1a2e; line-height:1.1; font-family:Georgia,serif;">ITPS <span style="color:#c0392b;">Tariff</span> Receipt</div>
          <div style="font-size:11px; color:#3d3d5c; margin-top:5px;">International Tracked Packet Service</div>
        </div>
        <div style="text-align:center; border:2.5px solid #c0392b; padding:8px 14px; min-width:78px;">
          <div style="font-size:20px; line-height:1;">&#9993;</div>
          <div style="font-size:7px; color:#c0392b; letter-spacing:1.5px; text-transform:uppercase; margin-top:4px; font-family:monospace;">India Post</div>
        </div>
      </div>

      <!-- Shipment info -->
      <div style="display:flex; gap:16px; margin-bottom:22px;">
        <div style="flex:1; background:white; border:1px solid #e8e0cc; border-bottom:2px solid #1a1a2e; padding:10px 14px;">
          <div style="font-size:8px; letter-spacing:2px; text-transform:uppercase; color:#3d3d5c; font-family:monospace; margin-bottom:4px;">Destination Country</div>
          <div style="font-size:14px; font-weight:600; color:#1a1a2e;">${c.countryVal}</div>
        </div>
        <div style="flex:1; background:white; border:1px solid #e8e0cc; border-bottom:2px solid #1a1a2e; padding:10px 14px;">
          <div style="font-size:8px; letter-spacing:2px; text-transform:uppercase; color:#3d3d5c; font-family:monospace; margin-bottom:4px;">Packet Weight</div>
          <div style="font-size:14px; font-weight:600; color:#1a1a2e;">${c.weightVal} grams</div>
        </div>
        <div style="flex:1; background:rgba(26,74,122,0.07); border:1px solid rgba(26,74,122,0.2); border-left:3px solid #1a4a7a; padding:10px 14px;">
          <div style="font-size:8px; letter-spacing:2px; text-transform:uppercase; color:#3d3d5c; font-family:monospace; margin-bottom:4px;">Max Permitted</div>
          <div style="font-size:14px; font-weight:600; color:#1a4a7a;">${c.data.maxWeight}</div>
        </div>
      </div>

      <!-- Postage Breakdown title -->
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:14px;">
        <div style="font-size:14px; font-weight:600; color:#1a1a2e; font-family:Georgia,serif;">Postage Breakdown</div>
        <div style="font-size:8px; letter-spacing:2px; color:#1a6b3c; background:rgba(26,107,60,0.1); border:1px solid rgba(26,107,60,0.3); padding:3px 8px; font-family:monospace; text-transform:uppercase;">&#10003; Calculated</div>
      </div>

      <!-- Receipt table -->
      <table style="width:100%; border-collapse:collapse; background:white; border:1px solid #e8e0cc;">
        <tr>
          <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-size:12px; color:#3d3d5c;">
            Base Tariff (First 50g)
            <div style="font-size:10px; color:#888; margin-top:2px;">Rs.${c.data.first50} for first 50g</div>
          </td>
          <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-family:monospace; font-size:14px; color:#1a1a2e; font-weight:600; text-align:right;">Rs.${c.baseTariff}.00</td>
        </tr>
        ${addRowHtml}
        <tr>
          <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-size:12px; color:#3d3d5c;">Subtotal (before GST)</td>
          <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-family:monospace; font-size:14px; color:#1a1a2e; font-weight:600; text-align:right;">Rs.${c.subtotal.toFixed(2)}</td>
        </tr>
        <tr style="background:rgba(26,107,60,0.05);">
          <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-size:12px; color:#3d3d5c;">GST @ 18%</td>
          <td style="padding:10px 16px; border-bottom:1px dashed #d6cabb; font-family:monospace; font-size:14px; color:#1a6b3c; font-weight:600; text-align:right;">Rs.${c.gst.toFixed(2)}</td>
        </tr>
        <tr style="background:#1a1a2e;">
          <td style="padding:13px 16px; font-family:monospace; font-size:11px; letter-spacing:2px; text-transform:uppercase; color:#f5f0e8;">Total Payable</td>
          <td style="padding:13px 16px; font-family:monospace; font-size:20px; font-weight:600; color:#d4a017; text-align:right;">Rs.${c.total.toFixed(2)}</td>
        </tr>
      </table>

      <!-- Calculation detail -->
      <div style="margin-top:14px; background:rgba(26,26,46,0.04); border:1px solid rgba(26,26,46,0.12); padding:12px 16px;">
        <div style="font-size:8px; letter-spacing:2px; text-transform:uppercase; color:#3d3d5c; font-family:monospace; margin-bottom:8px;">Calculation Detail</div>
        <table style="width:100%; border-collapse:collapse;">
          <tr><td style="padding:3px 0; font-size:11px; color:#555; font-family:monospace;">Base (first 50g)</td><td style="padding:3px 0; font-size:11px; color:#1a1a2e; font-family:monospace; text-align:right; font-weight:600;">Rs.${c.baseTariff}.00</td></tr>
          ${bLine2}
          ${bLine3}
        </table>
      </div>

      <!-- Footer -->
      <div style="margin-top:24px; padding-top:14px; border-top:1px solid rgba(26,26,46,0.12); display:flex; justify-content:space-between; align-items:center;">
        <div style="font-size:9px; color:rgba(26,26,46,0.4); font-family:monospace; letter-spacing:0.5px;">Tariffs in INR &middot; Subject to revision &middot; ${dateStr} ${timeStr}</div>
        <div style="font-size:11px; color:rgba(26,26,46,0.35); font-family:Georgia,serif; letter-spacing:1px;">India Post</div>
      </div>
    </div>
  </div>;
}

async function exportPDF() {
  if (!lastCalc) return;

  const loading = document.getElementById('pdfLoading');
  const tpl = document.getElementById('pdfTemplate');

  loading.classList.add('active');

  // Build receipt HTML in hidden template
  tpl.innerHTML = buildPdfTemplate(lastCalc);
  tpl.style.left = '-9999px';
  tpl.style.top = '0';
  tpl.style.position = 'fixed';

  // Wait for render
  await new Promise(r => setTimeout(r, 300));

  try {
    const canvas = await html2canvas(tpl.firstElementChild, {
      scale: 2.5,
      useCORS: true,
      backgroundColor: '#f5f0e8',
      logging: false,
      width: 560,
    });

    const imgData = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;

    // A4 page
    const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
    const pageW = 210;
    const pageH = 297;

    // Scale image to fit A4 with margins
    const margin = 20;
    const maxW = pageW - margin * 2;
    const imgW = canvas.width;
    const imgH = canvas.height;
    const ratio = imgH / imgW;
    const printW = maxW;
    const printH = printW * ratio;

    const xOffset = margin;
    const yOffset = (pageH - printH) / 2;

    pdf.addImage(imgData, 'PNG', xOffset, yOffset > 0 ? yOffset : margin, printW, printH);

    const filename = ITPS_Receipt_${lastCalc.countryVal.replace(/[^a-zA-Z]/g, '_')}_${lastCalc.weightVal}g.pdf;
    pdf.save(filename);
  } catch (e) {
    console.error('PDF generation failed:', e);
    alert('PDF generation failed. Please try again.');
  } finally {
    loading.classList.remove('active');
    tpl.innerHTML = '';
  }
}

// Allow Enter key to trigger calculate
document.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') calculate();
});
</script>

</body>
</html> 